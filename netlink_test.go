package main

import (
	"fmt"
	"os"
	"syscall"
	"testing"
	"unsafe"

	"github.com/hkwi/nlgo"
	"github.com/stretchr/testify/assert"
)

type mockGenlHub struct {
}

func (mgh *mockGenlHub) Family(familyName string) nlgo.GenlFamily {
	if familyName != "nl80211" {
		panic("mockGenlHub supports only family 'nl80211'")
	}
	return nlgo.GenlFamily{Id: 23, Name: "nl80211", Version: 1, Hdrsize: 0}
}

func (mgh *mockGenlHub) Sync(msg nlgo.GenlMessage) ([]nlgo.GenlMessage, error) {
	msgHdr := (*nlgo.GenlMsghdr)(unsafe.Pointer(&msg.NetlinkMessage.Data[0]))
	switch msgHdr.Cmd {
	case nlgo.NL80211_CMD_GET_INTERFACE:
		return []nlgo.GenlMessage{
			{
				NetlinkMessage: syscall.NetlinkMessage{
					Header: syscall.NlMsghdr{
						Len:   100,
						Type:  23,
						Flags: 2,
						Seq:   1479991629,
						Pid:   3553,
					},
					Data: []byte{7, 1, 0, 0, 8, 0, 3, 0, 4, 0, 0, 0, 15, 0, 4, 0, 119, 108, 95, 112, 114, 105, 118, 97, 116, 101, 0, 0, 8, 0, 1, 0, 0, 0, 0, 0, 8, 0, 5, 0, 2, 0, 0, 0, 12, 0, 153, 0, 1, 0, 0, 0, 0, 0, 0, 0, 10, 0, 6, 0, 0, 14, 142, 100, 39, 108, 0, 0, 8, 0, 46, 0, 5, 0, 0, 0, 8, 0, 98, 0, 220, 5, 0, 0},
				},
				Family: nlgo.GenlFamily{
					Id:      23,
					Name:    "nl80211",
					Version: 1,
					Hdrsize: 0,
				},
			},
			{
				NetlinkMessage: syscall.NetlinkMessage{
					Header: syscall.NlMsghdr{
						Len:   20,
						Type:  3,
						Flags: 2,
						Seq:   1479991629,
						Pid:   3553,
					},
					Data: []byte{0, 0, 0, 0},
				},
				Family: nlgo.GenlFamily{
					Id:      0,
					Name:    "",
					Version: 0,
					Hdrsize: 0,
				},
			},
		}, nil
	case nlgo.NL80211_CMD_GET_WIPHY:
		return []nlgo.GenlMessage{
			{
				NetlinkMessage: syscall.NetlinkMessage{
					Header: syscall.NlMsghdr{Len: 3528, Type: 23, Flags: 2, Seq: 1479994075, Pid: 2489257296},
					Data:   []byte{3, 1, 0, 0, 8, 0, 1, 0, 0, 0, 0, 0, 9, 0, 2, 0, 112, 104, 121, 48, 0, 0, 0, 0, 8, 0, 46, 0, 1, 0, 0, 0, 5, 0, 61, 0, 7, 0, 0, 0, 5, 0, 62, 0, 4, 0, 0, 0, 8, 0, 63, 0, 255, 255, 255, 255, 8, 0, 64, 0, 255, 255, 255, 255, 5, 0, 89, 0, 0, 0, 0, 0, 5, 0, 43, 0, 4, 0, 0, 0, 5, 0, 123, 0, 0, 0, 0, 0, 6, 0, 56, 0, 209, 8, 0, 0, 6, 0, 124, 0, 0, 0, 0, 0, 5, 0, 133, 0, 0, 0, 0, 0, 8, 0, 222, 0, 1, 0, 0, 0, 8, 0, 223, 0, 255, 255, 255, 255, 8, 0, 224, 0, 0, 0, 0, 0, 4, 0, 104, 0, 4, 0, 130, 0, 4, 0, 139, 0, 4, 0, 140, 0, 48, 0, 57, 0, 1, 172, 15, 0, 5, 172, 15, 0, 2, 172, 15, 0, 4, 172, 15, 0, 10, 172, 15, 0, 8, 172, 15, 0, 9, 172, 15, 0, 6, 172, 15, 0, 13, 172, 15, 0, 11, 172, 15, 0, 12, 172, 15, 0, 5, 0, 86, 0, 0, 0, 0, 0, 4, 0, 102, 0, 8, 0, 113, 0, 3, 0, 0, 0, 8, 0, 114, 0, 3, 0, 0, 0, 8, 0, 105, 0, 3, 0, 0, 0, 8, 0, 106, 0, 3, 0, 0, 0, 40, 0, 32, 0, 4, 0, 1, 0, 4, 0, 2, 0, 4, 0, 3, 0, 4, 0, 4, 0, 4, 0, 5, 0, 4, 0, 6, 0, 4, 0, 8, 0, 4, 0, 9, 0, 4, 0, 11, 0, 120, 5, 22, 0, 0, 2, 0, 0, 20, 0, 3, 0, 255, 255, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 0, 0, 0, 6, 0, 4, 0, 239, 17, 0, 0, 5, 0, 5, 0, 3, 0, 0, 0, 5, 0, 6, 0, 6, 0, 0, 0, 160, 0, 2, 0, 12, 0, 0, 0, 8, 0, 1, 0, 10, 0, 0, 0, 16, 0, 1, 0, 8, 0, 1, 0, 20, 0, 0, 0, 4, 0, 2, 0, 16, 0, 2, 0, 8, 0, 1, 0, 55, 0, 0, 0, 4, 0, 2, 0, 16, 0, 3, 0, 8, 0, 1, 0, 110, 0, 0, 0, 4, 0, 2, 0, 12, 0, 4, 0, 8, 0, 1, 0, 60, 0, 0, 0, 12, 0, 5, 0, 8, 0, 1, 0, 90, 0, 0, 0, 12, 0, 6, 0, 8, 0, 1, 0, 120, 0, 0, 0, 12, 0, 7, 0, 8, 0, 1, 0, 180, 0, 0, 0, 12, 0, 8, 0, 8, 0, 1, 0, 240, 0, 0, 0, 12, 0, 9, 0, 8, 0, 1, 0, 104, 1, 0, 0, 12, 0, 10, 0, 8, 0, 1, 0, 224, 1, 0, 0, 12, 0, 11, 0, 8, 0, 1, 0, 28, 2, 0, 0, 48, 1, 1, 0, 20, 0, 0, 0, 8, 0, 1, 0, 108, 9, 0, 0, 8, 0, 6, 0, 64, 6, 0, 0, 20, 0, 1, 0, 8, 0, 1, 0, 113, 9, 0, 0, 8, 0, 6, 0, 64, 6, 0, 0, 20, 0, 2, 0, 8, 0, 1, 0, 118, 9, 0, 0, 8, 0, 6, 0, 64, 6, 0, 0, 20, 0, 3, 0, 8, 0, 1, 0, 123, 9, 0, 0, 8, 0, 6, 0, 64, 6, 0, 0, 20, 0, 4, 0, 8, 0, 1, 0, 128, 9, 0, 0, 8, 0, 6, 0, 64, 6, 0, 0, 20, 0, 5, 0, 8, 0, 1, 0, 133, 9, 0, 0, 8, 0, 6, 0, 64, 6, 0, 0, 20, 0, 6, 0, 8, 0, 1, 0, 138, 9, 0, 0, 8, 0, 6, 0, 64, 6, 0, 0, 20, 0, 7, 0, 8, 0, 1, 0, 143, 9, 0, 0, 8, 0, 6, 0, 64, 6, 0, 0, 20, 0, 8, 0, 8, 0, 1, 0, 148, 9, 0, 0, 8, 0, 6, 0, 64, 6, 0, 0, 20, 0, 9, 0, 8, 0, 1, 0, 153, 9, 0, 0, 8, 0, 6, 0, 64, 6, 0, 0, 20, 0, 10, 0, 8, 0, 1, 0, 158, 9, 0, 0, 8, 0, 6, 0, 64, 6, 0, 0, 28, 0, 11, 0, 8, 0, 1, 0, 163, 9, 0, 0, 4, 0, 3, 0, 4, 0, 4, 0, 8, 0, 6, 0, 64, 6, 0, 0, 28, 0, 12, 0, 8, 0, 1, 0, 168, 9, 0, 0, 4, 0, 3, 0, 4, 0, 4, 0, 8, 0, 6, 0, 64, 6, 0, 0, 24, 0, 13, 0, 8, 0, 1, 0, 180, 9, 0, 0, 4, 0, 2, 0, 8, 0, 6, 0, 208, 7, 0, 0, 116, 3, 1, 0, 20, 0, 3, 0, 255, 255, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 0, 0, 0, 6, 0, 4, 0, 239, 17, 0, 0, 5, 0, 5, 0, 3, 0, 0, 0, 5, 0, 6, 0, 6, 0, 0, 0, 100, 0, 2, 0, 12, 0, 0, 0, 8, 0, 1, 0, 60, 0, 0, 0, 12, 0, 1, 0, 8, 0, 1, 0, 90, 0, 0, 0, 12, 0, 2, 0, 8, 0, 1, 0, 120, 0, 0, 0, 12, 0, 3, 0, 8, 0, 1, 0, 180, 0, 0, 0, 12, 0, 4, 0, 8, 0, 1, 0, 240, 0, 0, 0, 12, 0, 5, 0, 8, 0, 1, 0, 104, 1, 0, 0, 12, 0, 6, 0, 8, 0, 1, 0, 224, 1, 0, 0, 12, 0, 7, 0, 8, 0, 1, 0, 28, 2, 0, 0, 224, 2, 1, 0, 28, 0, 0, 0, 8, 0, 1, 0, 60, 20, 0, 0, 4, 0, 3, 0, 4, 0, 4, 0, 8, 0, 6, 0, 220, 5, 0, 0, 28, 0, 1, 0, 8, 0, 1, 0, 80, 20, 0, 0, 4, 0, 3, 0, 4, 0, 4, 0, 8, 0, 6, 0, 220, 5, 0, 0, 28, 0, 2, 0, 8, 0, 1, 0, 100, 20, 0, 0, 4, 0, 3, 0, 4, 0, 4, 0, 8, 0, 6, 0, 220, 5, 0, 0, 28, 0, 3, 0, 8, 0, 1, 0, 120, 20, 0, 0, 4, 0, 3, 0, 4, 0, 4, 0, 8, 0, 6, 0, 64, 6, 0, 0, 32, 0, 4, 0, 8, 0, 1, 0, 140, 20, 0, 0, 4, 0, 3, 0, 4, 0, 4, 0, 4, 0, 5, 0, 8, 0, 6, 0, 220, 5, 0, 0, 32, 0, 5, 0, 8, 0, 1, 0, 160, 20, 0, 0, 4, 0, 3, 0, 4, 0, 4, 0, 4, 0, 5, 0, 8, 0, 6, 0, 220, 5, 0, 0, 32, 0, 6, 0, 8, 0, 1, 0, 180, 20, 0, 0, 4, 0, 3, 0, 4, 0, 4, 0, 4, 0, 5, 0, 8, 0, 6, 0, 220, 5, 0, 0, 32, 0, 7, 0, 8, 0, 1, 0, 200, 20, 0, 0, 4, 0, 3, 0, 4, 0, 4, 0, 4, 0, 5, 0, 8, 0, 6, 0, 220, 5, 0, 0, 32, 0, 8, 0, 8, 0, 1, 0, 124, 21, 0, 0, 4, 0, 3, 0, 4, 0, 4, 0, 4, 0, 5, 0, 8, 0, 6, 0, 164, 6, 0, 0, 32, 0, 9, 0, 8, 0, 1, 0, 144, 21, 0, 0, 4, 0, 3, 0, 4, 0, 4, 0, 4, 0, 5, 0, 8, 0, 6, 0, 164, 6, 0, 0, 32, 0, 10, 0, 8, 0, 1, 0, 164, 21, 0, 0, 4, 0, 3, 0, 4, 0, 4, 0, 4, 0, 5, 0, 8, 0, 6, 0, 164, 6, 0, 0, 32, 0, 11, 0, 8, 0, 1, 0, 184, 21, 0, 0, 4, 0, 3, 0, 4, 0, 4, 0, 4, 0, 5, 0, 8, 0, 6, 0, 164, 6, 0, 0, 32, 0, 12, 0, 8, 0, 1, 0, 204, 21, 0, 0, 4, 0, 3, 0, 4, 0, 4, 0, 4, 0, 5, 0, 8, 0, 6, 0, 164, 6, 0, 0, 32, 0, 13, 0, 8, 0, 1, 0, 224, 21, 0, 0, 4, 0, 3, 0, 4, 0, 4, 0, 4, 0, 5, 0, 8, 0, 6, 0, 164, 6, 0, 0, 32, 0, 14, 0, 8, 0, 1, 0, 244, 21, 0, 0, 4, 0, 3, 0, 4, 0, 4, 0, 4, 0, 5, 0, 8, 0, 6, 0, 164, 6, 0, 0, 32, 0, 15, 0, 8, 0, 1, 0, 8, 22, 0, 0, 4, 0, 3, 0, 4, 0, 4, 0, 4, 0, 5, 0, 8, 0, 6, 0, 164, 6, 0, 0, 32, 0, 16, 0, 8, 0, 1, 0, 28, 22, 0, 0, 4, 0, 3, 0, 4, 0, 4, 0, 4, 0, 5, 0, 8, 0, 6, 0, 164, 6, 0, 0, 32, 0, 17, 0, 8, 0, 1, 0, 48, 22, 0, 0, 4, 0, 3, 0, 4, 0, 4, 0, 4, 0, 5, 0, 8, 0, 6, 0, 164, 6, 0, 0, 32, 0, 18, 0, 8, 0, 1, 0, 68, 22, 0, 0, 4, 0, 3, 0, 4, 0, 4, 0, 4, 0, 5, 0, 8, 0, 6, 0, 164, 6, 0, 0, 28, 0, 19, 0, 8, 0, 1, 0, 113, 22, 0, 0, 4, 0, 3, 0, 4, 0, 4, 0, 8, 0, 6, 0, 8, 7, 0, 0, 28, 0, 20, 0, 8, 0, 1, 0, 133, 22, 0, 0, 4, 0, 3, 0, 4, 0, 4, 0, 8, 0, 6, 0, 8, 7, 0, 0, 28, 0, 21, 0, 8, 0, 1, 0, 153, 22, 0, 0, 4, 0, 3, 0, 4, 0, 4, 0, 8, 0, 6, 0, 8, 7, 0, 0, 28, 0, 22, 0, 8, 0, 1, 0, 173, 22, 0, 0, 4, 0, 3, 0, 4, 0, 4, 0, 8, 0, 6, 0, 8, 7, 0, 0, 28, 0, 23, 0, 8, 0, 1, 0, 193, 22, 0, 0, 4, 0, 3, 0, 4, 0, 4, 0, 8, 0, 6, 0, 8, 7, 0, 0, 220, 0, 50, 0, 8, 0, 1, 0, 7, 0, 0, 0, 8, 0, 2, 0, 6, 0, 0, 0, 8, 0, 3, 0, 11, 0, 0, 0, 8, 0, 4, 0, 15, 0, 0, 0, 8, 0, 5, 0, 19, 0, 0, 0, 8, 0, 6, 0, 25, 0, 0, 0, 8, 0, 7, 0, 37, 0, 0, 0, 8, 0, 8, 0, 38, 0, 0, 0, 8, 0, 9, 0, 39, 0, 0, 0, 8, 0, 10, 0, 40, 0, 0, 0, 8, 0, 11, 0, 43, 0, 0, 0, 8, 0, 12, 0, 55, 0, 0, 0, 8, 0, 13, 0, 57, 0, 0, 0, 8, 0, 14, 0, 59, 0, 0, 0, 8, 0, 15, 0, 67, 0, 0, 0, 8, 0, 16, 0, 49, 0, 0, 0, 8, 0, 17, 0, 65, 0, 0, 0, 8, 0, 18, 0, 66, 0, 0, 0, 8, 0, 19, 0, 82, 0, 0, 0, 8, 0, 20, 0, 81, 0, 0, 0, 8, 0, 21, 0, 84, 0, 0, 0, 8, 0, 22, 0, 87, 0, 0, 0, 8, 0, 23, 0, 85, 0, 0, 0, 8, 0, 24, 0, 89, 0, 0, 0, 8, 0, 25, 0, 92, 0, 0, 0, 8, 0, 26, 0, 46, 0, 0, 0, 8, 0, 27, 0, 48, 0, 0, 0, 8, 0, 111, 0, 136, 19, 0, 0, 4, 0, 108, 0, 52, 4, 99, 0, 4, 0, 0, 0, 132, 0, 1, 0, 6, 0, 101, 0, 0, 0, 0, 0, 6, 0, 101, 0, 16, 0, 0, 0, 6, 0, 101, 0, 32, 0, 0, 0, 6, 0, 101, 0, 48, 0, 0, 0, 6, 0, 101, 0, 64, 0, 0, 0, 6, 0, 101, 0, 80, 0, 0, 0, 6, 0, 101, 0, 96, 0, 0, 0, 6, 0, 101, 0, 112, 0, 0, 0, 6, 0, 101, 0, 128, 0, 0, 0, 6, 0, 101, 0, 144, 0, 0, 0, 6, 0, 101, 0, 160, 0, 0, 0, 6, 0, 101, 0, 176, 0, 0, 0, 6, 0, 101, 0, 192, 0, 0, 0, 6, 0, 101, 0, 208, 0, 0, 0, 6, 0, 101, 0, 224, 0, 0, 0, 6, 0, 101, 0, 240, 0, 0, 0, 132, 0, 2, 0, 6, 0, 101, 0, 0, 0, 0, 0, 6, 0, 101, 0, 16, 0, 0, 0, 6, 0, 101, 0, 32, 0, 0, 0, 6, 0, 101, 0, 48, 0, 0, 0, 6, 0, 101, 0, 64, 0, 0, 0, 6, 0, 101, 0, 80, 0, 0, 0, 6, 0, 101, 0, 96, 0, 0, 0, 6, 0, 101, 0, 112, 0, 0, 0, 6, 0, 101, 0, 128, 0, 0, 0, 6, 0, 101, 0, 144, 0, 0, 0, 6, 0, 101, 0, 160, 0, 0, 0, 6, 0, 101, 0, 176, 0, 0, 0, 6, 0, 101, 0, 192, 0, 0, 0, 6, 0, 101, 0, 208, 0, 0, 0, 6, 0, 101, 0, 224, 0, 0, 0, 6, 0, 101, 0, 240, 0, 0, 0, 132, 0, 3, 0, 6, 0, 101, 0, 0, 0, 0, 0, 6, 0, 101, 0, 16, 0, 0, 0, 6, 0, 101, 0, 32, 0, 0, 0, 6, 0, 101, 0, 48, 0, 0, 0, 6, 0, 101, 0, 64, 0, 0, 0, 6, 0, 101, 0, 80, 0, 0, 0, 6, 0, 101, 0, 96, 0, 0, 0, 6, 0, 101, 0, 112, 0, 0, 0, 6, 0, 101, 0, 128, 0, 0, 0, 6, 0, 101, 0, 144, 0, 0, 0, 6, 0, 101, 0, 160, 0, 0, 0, 6, 0, 101, 0, 176, 0, 0, 0, 6, 0, 101, 0, 192, 0, 0, 0, 6, 0, 101, 0, 208, 0, 0, 0, 6, 0, 101, 0, 224, 0, 0, 0, 6, 0, 101, 0, 240, 0, 0, 0, 132, 0, 4, 0, 6, 0, 101, 0, 0, 0, 0, 0, 6, 0, 101, 0, 16, 0, 0, 0, 6, 0, 101, 0, 32, 0, 0, 0, 6, 0, 101, 0, 48, 0, 0, 0, 6, 0, 101, 0, 64, 0, 0, 0, 6, 0, 101, 0, 80, 0, 0, 0, 6, 0, 101, 0, 96, 0, 0, 0, 6, 0, 101, 0, 112, 0, 0, 0, 6, 0, 101, 0, 128, 0, 0, 0, 6, 0, 101, 0, 144, 0, 0, 0, 6, 0, 101, 0, 160, 0, 0, 0, 6, 0, 101, 0, 176, 0, 0, 0, 6, 0, 101, 0, 192, 0, 0, 0, 6, 0, 101, 0, 208, 0, 0, 0, 6, 0, 101, 0, 224, 0, 0, 0, 6, 0, 101, 0, 240, 0, 0, 0, 4, 0, 5, 0, 4, 0, 6, 0, 132, 0, 7, 0, 6, 0, 101, 0, 0, 0, 0, 0, 6, 0, 101, 0, 16, 0, 0, 0, 6, 0, 101, 0, 32, 0, 0, 0, 6, 0, 101, 0, 48, 0, 0, 0, 6, 0, 101, 0, 64, 0, 0, 0, 6, 0, 101, 0, 80, 0, 0, 0, 6, 0, 101, 0, 96, 0, 0, 0, 6, 0, 101, 0, 112, 0, 0, 0, 6, 0, 101, 0, 128, 0, 0, 0, 6, 0, 101, 0, 144, 0, 0, 0, 6, 0, 101, 0, 160, 0, 0, 0, 6, 0, 101, 0, 176, 0, 0, 0, 6, 0, 101, 0, 192, 0, 0, 0, 6, 0, 101, 0, 208, 0, 0, 0, 6, 0, 101, 0, 224, 0, 0, 0, 6, 0, 101, 0, 240, 0, 0, 0, 132, 0, 8, 0, 6, 0, 101, 0, 0, 0, 0, 0, 6, 0, 101, 0, 16, 0, 0, 0, 6, 0, 101, 0, 32, 0, 0, 0, 6, 0, 101, 0, 48, 0, 0, 0, 6, 0, 101, 0, 64, 0, 0, 0, 6, 0, 101, 0, 80, 0, 0, 0, 6, 0, 101, 0, 96, 0, 0, 0, 6, 0, 101, 0, 112, 0, 0, 0, 6, 0, 101, 0, 128, 0, 0, 0, 6, 0, 101, 0, 144, 0, 0, 0, 6, 0, 101, 0, 160, 0, 0, 0, 6, 0, 101, 0, 176, 0, 0, 0, 6, 0, 101, 0, 192, 0, 0, 0, 6, 0, 101, 0, 208, 0, 0, 0, 6, 0, 101, 0, 224, 0, 0, 0, 6, 0, 101, 0, 240, 0, 0, 0, 132, 0, 9, 0, 6, 0, 101, 0, 0, 0, 0, 0, 6, 0, 101, 0, 16, 0, 0, 0, 6, 0, 101, 0, 32, 0, 0, 0, 6, 0, 101, 0, 48, 0, 0, 0, 6, 0, 101, 0, 64, 0, 0, 0, 6, 0, 101, 0, 80, 0, 0, 0, 6, 0, 101, 0, 96, 0, 0, 0, 6, 0, 101, 0, 112, 0, 0, 0, 6, 0, 101, 0, 128, 0, 0, 0, 6, 0, 101, 0, 144, 0, 0, 0, 6, 0, 101, 0, 160, 0, 0, 0, 6, 0, 101, 0, 176, 0, 0, 0, 6, 0, 101, 0, 192, 0, 0, 0, 6, 0, 101, 0, 208, 0, 0, 0, 6, 0, 101, 0, 224, 0, 0, 0, 6, 0, 101, 0, 240, 0, 0, 0, 132, 0, 10, 0, 6, 0, 101, 0, 0, 0, 0, 0, 6, 0, 101, 0, 16, 0, 0, 0, 6, 0, 101, 0, 32, 0, 0, 0, 6, 0, 101, 0, 48, 0, 0, 0, 6, 0, 101, 0, 64, 0, 0, 0, 6, 0, 101, 0, 80, 0, 0, 0, 6, 0, 101, 0, 96, 0, 0, 0, 6, 0, 101, 0, 112, 0, 0, 0, 6, 0, 101, 0, 128, 0, 0, 0, 6, 0, 101, 0, 144, 0, 0, 0, 6, 0, 101, 0, 160, 0, 0, 0, 6, 0, 101, 0, 176, 0, 0, 0, 6, 0, 101, 0, 192, 0, 0, 0, 6, 0, 101, 0, 208, 0, 0, 0, 6, 0, 101, 0, 224, 0, 0, 0, 6, 0, 101, 0, 240, 0, 0, 0, 4, 0, 11, 0, 68, 1, 100, 0, 4, 0, 0, 0, 36, 0, 1, 0, 6, 0, 101, 0, 64, 0, 0, 0, 6, 0, 101, 0, 176, 0, 0, 0, 6, 0, 101, 0, 192, 0, 0, 0, 6, 0, 101, 0, 208, 0, 0, 0, 20, 0, 2, 0, 6, 0, 101, 0, 64, 0, 0, 0, 6, 0, 101, 0, 208, 0, 0, 0, 60, 0, 3, 0, 6, 0, 101, 0, 0, 0, 0, 0, 6, 0, 101, 0, 32, 0, 0, 0, 6, 0, 101, 0, 64, 0, 0, 0, 6, 0, 101, 0, 160, 0, 0, 0, 6, 0, 101, 0, 176, 0, 0, 0, 6, 0, 101, 0, 192, 0, 0, 0, 6, 0, 101, 0, 208, 0, 0, 0, 60, 0, 4, 0, 6, 0, 101, 0, 0, 0, 0, 0, 6, 0, 101, 0, 32, 0, 0, 0, 6, 0, 101, 0, 64, 0, 0, 0, 6, 0, 101, 0, 160, 0, 0, 0, 6, 0, 101, 0, 176, 0, 0, 0, 6, 0, 101, 0, 192, 0, 0, 0, 6, 0, 101, 0, 208, 0, 0, 0, 4, 0, 5, 0, 4, 0, 6, 0, 28, 0, 7, 0, 6, 0, 101, 0, 176, 0, 0, 0, 6, 0, 101, 0, 192, 0, 0, 0, 6, 0, 101, 0, 208, 0, 0, 0, 20, 0, 8, 0, 6, 0, 101, 0, 64, 0, 0, 0, 6, 0, 101, 0, 208, 0, 0, 0, 60, 0, 9, 0, 6, 0, 101, 0, 0, 0, 0, 0, 6, 0, 101, 0, 32, 0, 0, 0, 6, 0, 101, 0, 64, 0, 0, 0, 6, 0, 101, 0, 160, 0, 0, 0, 6, 0, 101, 0, 176, 0, 0, 0, 6, 0, 101, 0, 192, 0, 0, 0, 6, 0, 101, 0, 208, 0, 0, 0, 20, 0, 10, 0, 6, 0, 101, 0, 64, 0, 0, 0, 6, 0, 101, 0, 208, 0, 0, 0, 4, 0, 11, 0, 12, 0, 121, 0, 4, 0, 4, 0, 4, 0, 6, 0, 144, 0, 120, 0, 92, 0, 1, 0, 68, 0, 1, 0, 20, 0, 1, 0, 8, 0, 1, 0, 0, 8, 0, 0, 8, 0, 2, 0, 4, 0, 2, 0, 20, 0, 2, 0, 8, 0, 1, 0, 8, 0, 0, 0, 8, 0, 2, 0, 4, 0, 3, 0, 24, 0, 3, 0, 8, 0, 1, 0, 1, 0, 0, 0, 12, 0, 2, 0, 4, 0, 8, 0, 4, 0, 9, 0, 4, 0, 3, 0, 8, 0, 4, 0, 1, 0, 0, 0, 8, 0, 2, 0, 0, 8, 0, 0, 48, 0, 2, 0, 24, 0, 1, 0, 20, 0, 1, 0, 8, 0, 1, 0, 0, 8, 0, 0, 8, 0, 2, 0, 4, 0, 5, 0, 4, 0, 3, 0, 8, 0, 4, 0, 1, 0, 0, 0, 8, 0, 2, 0, 0, 8, 0, 0, 8, 0, 143, 0, 227, 139, 7, 8, 30, 0, 148, 0, 99, 72, 31, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0},
				},
				Family: nlgo.GenlFamily{Id: 23, Name: "nl80211", Version: 1, Hdrsize: 0},
			},
			{
				NetlinkMessage: syscall.NetlinkMessage{
					Header: syscall.NlMsghdr{Len: 88, Type: 23, Flags: 2, Seq: 1479994075, Pid: 2489257296},
					Data:   []byte{3, 1, 0, 0, 8, 0, 1, 0, 0, 0, 0, 0, 9, 0, 2, 0, 112, 104, 121, 48, 0, 0, 0, 0, 8, 0, 46, 0, 1, 0, 0, 0, 12, 0, 169, 0, 0, 0, 0, 0, 0, 0, 0, 64, 12, 0, 170, 0, 0, 0, 0, 0, 0, 0, 0, 64, 16, 0, 176, 0, 240, 31, 128, 51, 255, 255, 0, 0, 255, 255, 0, 0},
				},
				Family: nlgo.GenlFamily{Id: 23, Name: "nl80211", Version: 1, Hdrsize: 0},
			},
			{
				NetlinkMessage: syscall.NetlinkMessage{
					Header: syscall.NlMsghdr{Len: 56, Type: 23, Flags: 2, Seq: 1479994075, Pid: 2489257296},
					Data:   []byte{3, 1, 0, 0, 8, 0, 1, 0, 0, 0, 0, 0, 9, 0, 2, 0, 112, 104, 121, 48, 0, 0, 0, 0, 8, 0, 46, 0, 1, 0, 0, 0, 4, 0, 192, 0, 4, 0, 193, 0},
				},
				Family: nlgo.GenlFamily{Id: 23, Name: "nl80211", Version: 1, Hdrsize: 0},
			},
			{
				NetlinkMessage: syscall.NetlinkMessage{
					Header: syscall.NlMsghdr{Len: 48, Type: 23, Flags: 2, Seq: 1479994075, Pid: 2489257296},
					Data:   []byte{3, 1, 0, 0, 8, 0, 1, 0, 0, 0, 0, 0, 9, 0, 2, 0, 112, 104, 121, 48, 0, 0, 0, 0, 8, 0, 46, 0, 1, 0, 0, 0},
				},
				Family: nlgo.GenlFamily{Id: 23, Name: "nl80211", Version: 1, Hdrsize: 0},
			},
			{
				NetlinkMessage: syscall.NetlinkMessage{
					Header: syscall.NlMsghdr{Len: 64, Type: 23, Flags: 2, Seq: 1479994075, Pid: 2489257296},
					Data:   []byte{3, 1, 0, 0, 8, 0, 1, 0, 0, 0, 0, 0, 9, 0, 2, 0, 112, 104, 121, 48, 0, 0, 0, 0, 8, 0, 46, 0, 1, 0, 0, 0, 5, 0, 206, 0, 2, 0, 0, 0, 5, 0, 217, 0, 2, 0, 0, 0},
				},
				Family: nlgo.GenlFamily{Id: 23, Name: "nl80211", Version: 1, Hdrsize: 0},
			},
			{
				NetlinkMessage: syscall.NetlinkMessage{
					Header: syscall.NlMsghdr{Len: 20, Type: 3, Flags: 2, Seq: 1479994075, Pid: 2489257296},
					Data:   []byte{0, 0, 0, 0},
				},
				Family: nlgo.GenlFamily{Id: 0, Name: "", Version: 0, Hdrsize: 0},
			},
		}, nil
	default:
		panic(fmt.Sprintf("unexpected message %+v", msg))
	}
}

func TestMain(m *testing.M) {
	newGenHub = func() (genlHuber, error) {
		return &mockGenlHub{}, nil
	}

	os.Exit(m.Run())
}

func TestGetLogicalInterfaces(t *testing.T) {
	ifs, err := getLogicalInterfaces()
	assert.Nil(t, err)
	assert.NotNil(t, ifs)
	assert.Len(t, ifs, 1)
	assert.Equal(t, "wl_private", ifs[0])
}

func TestGetPhysicalInterfaces(t *testing.T) {
	ifs, err := getPhysicalInterfaces()
	assert.Nil(t, err)
	assert.NotNil(t, ifs)
	assert.Len(t, ifs, 1)
	assert.Equal(t, "phy0", ifs[0])
}
